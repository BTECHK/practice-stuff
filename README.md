/*  /*******************************************************************************  * Title:        SALARY BOOK REPORT                                                                      * Description:  Capture a wide cross section of colleague data.  Report is scheduled to run on a daily basis and maintained for future reference.  *                                                                                                                                        * Logic info:   One Parameter is used (Effective Date):   *          * Date        Developer  Description                                                                                    * ----------  ---------  -------------------------------------------------------------------       * 01/01/2014 Sanghavi   Initial                                                                                           * 05/31/2017 Hager - Update the way Last Performance Rating is pulled so as to pull the current rating after the Performance Appraisals are finalized.  * 08/28/2017 Swanson    Reformat "select" for correct representation of # and date  ********************************************************************************/ SELECT CASE          WHEN To_char(paa.effective_start_date, 'MONTH') = 01 THEN 'Janurary'          WHEN To_char(paa.effective_start_date, 'MONTH') = 02 THEN 'February'          WHEN To_char(paa.effective_start_date, 'MONTH') = 03 THEN 'March'          WHEN To_char(paa.effective_start_date, 'MONTH') = 04 THEN 'April'          WHEN To_char(paa.effective_start_date, 'MONTH') = 05 THEN 'May'          WHEN To_char(paa.effective_start_date, 'MONTH') = 06 THEN 'June'          WHEN To_char(paa.effective_start_date, 'MONTH') = 07 THEN 'July'          WHEN To_char(paa.effective_start_date, 'MONTH') = 08 THEN 'August'          WHEN To_char(paa.effective_start_date, 'MONTH') = 09 THEN 'September'          WHEN To_char(paa.effective_start_date, 'MONTH') = 10 THEN 'October'          WHEN To_char(paa.effective_start_date, 'MONTH') = 11 THEN 'November'          ELSE 'December'        END                                                     report_month,        hao.attribute3                                          region,        papf.person_id                                          perid        --dms added for g_2         ,        To_char(Lpad (papf.person_number, 6, '0'))              person_number,        paa.assignment_number        --dms added to_char         /* ,ppn.last_name || ', ' || ppn.first_name || ' ' || ppn.middle_names   */        ,        ppn.full_name                                           name,        haotl.name        Entity_cost_center,        dp.name                                                 Dept,        pj.job_code                                             jobCode,        pj.attribute5                                           jobTitle,        pjp.name                                                Job_name,        pgf.grade_code                                          PG,        ppei.pei_information1                                   Officer_Type,        CASE          WHEN ( Substr (pgf.grade_code, 1, 2) ) IN ( '44', '45', '46', '47',                                                      '48', 'Ex' ) THEN '44+'          WHEN ( Substr (pgf.grade_code, 1, 2) ) IN ( '42', '43' ) THEN '42 & 43'          WHEN ( Substr (pgf.grade_code, 1, 2) ) IN ( '40', '41' ) THEN '40 & 41'          WHEN ( Substr (pgf.grade_code, 1, 2) ) IN ( 'Un', 'no' ) THEN 'none'          ELSE '39 & below'        END                                                     PG_Group,        ( ( SYSDATE - ppos.date_start ) / 365 )                 Tenure,        CASE          WHEN ( ( SYSDATE - ppos.date_start ) / 365 ) < 1 THEN 'Less than 1'          WHEN ( ( SYSDATE - ppos.date_start ) / 365 ) BETWEEN 1 AND 2 THEN          '1 to 2'          WHEN ( ( SYSDATE - ppos.date_start ) / 365 ) BETWEEN 2 AND 3 THEN          '2 to 3'          ELSE '3+'        END                                                     tenure_group,        ( ( SYSDATE - paa.effective_start_date ) / 364.25 )        Time_in_position_current,        ( ( paa.effective_start_date - (SELECT Max (paa_z.effective_start_date)                                        FROM   per_all_assignments_m paa_z                                        WHERE            paa.assignment_id = paa_z.assignment_id            AND paa_z.effective_start_date < (SELECT                Max (paa_z.effective_start_date)                                              FROM                per_all_assignments_m paa_z                                              WHERE        paa.assignment_id = paa_z.assignment_id        AND paa_z.effective_start_date <=            SYSDATE)) ) / 364.25 )        time_in_position_prior,        pawm.value                                              FTE,        fndCat.meaning                                          Emp_Category,        ppn2.full_name                                          supName,        hla.location_code                                       location_code,        paa.internal_mailstop                                   mailStop,        fabu.bu_name                                            businessUnit,        hao.attribute1                                          businessRegion,        -- Bu Region         hao.attribute2                                          businessDistict,        -- Bu District         Substr (dp.name, 1, 3)                                  compdesc,        pea1.email_address                                      peremail,        paa.ass_attribute6                                      KLT,        per1.date_of_birth                                      BirthDate,        CASE          WHEN per1.date_of_birth <= To_date('12-31-1942', 'mm-dd-yyyy') THEN          'Tradistionalists'          WHEN per1.date_of_birth BETWEEN To_date('12-31-1942', 'mm-dd-yyyy') AND                                          To_date(                                          '12-31-1960', 'mm-dd-yyyy') THEN          'Babyboomers'          WHEN per1.date_of_birth BETWEEN To_date('12-31-1960', 'mm-dd-yyyy') AND                                          To_date(                                          '12-31-1981', 'mm-dd-yyyy') THEN          'Generation Xers'          ELSE 'Milennials'        END                                                     Generation,        ( ( SYSDATE - per1.date_of_birth ) / 364.25 )           Age,        --,round(months_between(:p_effective_date, per1.date_of_birth)/12,2)  Age         leg.sex                                                 Gender,        fnd.meaning                                             Ethnicity,        Decode(sb.salary_basis_code, 'HOURLY', Round(sal.salary_amount, 2),                                     0)                         HourlyRate,        Decode(sb.salary_basis_code, 'ANNUAL', sal.salary_amount,                                     0)                         AnnualSalary,        Decode(sb.salary_basis_code, 'HOURLY', (        ( sal.salary_amount * 2080 ) * pawm.value ),                                     sal.salary_amount)         Annualized_Salary        ,        CASE          WHEN ppos.adjusted_svc_date IS NOT NULL               AND ppos.adjusted_svc_date <= ppos.date_start THEN        /* dms date format to_char (ppos.ADJUSTED_SVC_DATE,'MM/DD/YYYY') */        ppos.adjusted_svc_date --dms date field as date for better formatting           ELSE /*dms date format change to_char(ppos.date_start,'MM/DD/YYYY') */        ppos.date_start --dms date field as date for better formatting         END        Derived_last_hire_date,        /* round(months_between(:p_effective_date, ppos.date_start)/12,2) */        /*  CASE               WHEN    ppos.ADJUSTED_SVC_DATE is not null and ppos.ADJUSTED_SVC_DATE <= ppos.date_start         then round(months_between(:p_effective_date, ppos.ADJUSTED_SVC_DATE)/12,2)             ELSE round(months_between(:p_effective_date, ppos.date_start)/12,2)                END                                                 Tenure */        CASE          WHEN Substr(dp.name, 1, 3) = '001' THEN          'Associated Bank, National Association'          WHEN Substr(dp.name, 1, 3) = '004' THEN 'Associated Trust Company, NA'          WHEN Substr(dp.name, 1, 3) = '006' THEN          'Associated Financial Group, LLC'          WHEN Substr(dp.name, 1, 3) = '011' THEN          'Associated Investment Services, Inc.'          WHEN Substr(dp.name, 1, 3) = '023' THEN 'Whitnell & Company'          --DMS add new company for acq 10/30/17           ELSE 'not defined'        END                                                     compdesc        /* dms change date output to date     ,  to_char(ppos.date_start,'MM/DD/YYYY')                  Legal_Employer_Hire_Date                ,  to_char(ppos.ORIGINAL_DATE_OF_HIRE,'MM/DD/YYYY')      Enterprise_Seniority_Date          ,  to_char(ppos.ADJUSTED_SVC_DATE,'MM/DD/YYYY')          Legal_Employer_Seniority_Date*/        ,        ppos.date_start        Legal_Employer_Hire_Date --dms date field as date for better formatting         ,        ppos.adjusted_svc_date        Legal_Employer_Seniority_Date        --dms date field as date for better formatting         ,        ppos.original_date_of_hire        Enterprise_Seniority_Date --dms date field as date for better formatting         /* dms replace to_char on hiredate to field  , TO_CHAR ( ppos.date_start, 'MM/DD/YYYY', 'nls_date_language = American')  hireDt*/        ,        ppos.date_start                                         hireDt        --dms brought back this date field as date for better formatting         ,        Decode (Nvl (pjl.information1, 'a'), 'EXEMPT', 'E',                                             'NONEXEMPT', 'NE') jobInfo,        prv.mid_value * 1                                       PGMidPoint        -- dms change value to number  /*   , NVL ( pea1.email_address,                (SELECT pea3.email_address                   FROM per_email_addresses pea3                  WHERE 1 = 1                    AND pea3.person_id = papf.person_id                   AND pea3.email_type =  'W1'                    /*--AND :p_effective_date BETWEEN NVL ( pea3.date_from, :p_effective_date) AND NVL(pea3.date_to,:p_effective_date)--                    AND ROWNUM = 1)              )                                           perEmail */        /* , NVL ( REGEXP_REPLACE ( (pp1.area_code || pp1.phone_number), '[^[:digit:]]+')                    , (SELECT REGEXP_REPLACE (  (pp3.area_code || pp3.phone_number) , '[^[:digit:]]+')                       FROM   per_phones pp3                       WHERE  1=1                       AND   pp3.person_id              =   papf.person_id                       AND   pp3.phone_type             =   'W1'                       -- AND   pp3.phone_id               =   papf.primary_phone_id --                       AND   :p_effective_date             BETWEEN pp3.date_from  AND nvl ( pp3.date_to  , :p_effective_date)                       AND   rownum = 1 )                  )                                            perPhone */ /*  , ( SELECT REGEXP_REPLACE ( pp2.area_code || pp2.phone_number, '[^[:digit:]]+')              FROM per_phones pp2        -- Work Fax             WHERE 1 = 1               AND pp2.person_id (+) =   papf.person_id               AND pp2.phone_type (+) =   'WF'               AND :p_effective_date BETWEEN pp2.date_from (+) AND NVL(pp2.date_to(+), :p_effective_date)               AND ROWNUM = 1           )                                                perFax */        /* ,          Decode (Regexp_substr (Lower (past.user_status), 'active'), 'active',          'Active',         past.user_status)         assStatus, */        /*per1.attribute1                                         networkId, */        /*paa.ass_attribute9                                      nmls */        /* Hager: Change the way Last Performance Rating is pulled to use the Talent Profile and not the information from the Compensation Module 2017-05-31              ,(SELECT              perf.performance_rating                       FROM                      (SELECT              max(paa.last_update_date) date_updated,             ccpi.person_id,             ccpi.custom_segment3 performance_rating                                      FROM                      fusion.cmp_cwb_person_info ccpi,             fusion.per_all_assignments_m paa                              WHERE               ccpi.plan_id = '300000060991109'                     and ccpi.custom_segment3 is not null                             and paa.assignment_id = ccpi.assignment_id             and paa.person_id = ccpi.person_id                     and paa.assignment_status_type = 'ACTIVE'                     and paa.system_person_type = 'EMP'             and paa.assignment_type = 'E'             and paa.primary_flag = 'Y'             and paa.effective_latest_change = 'Y'                             group by             ccpi.person_id,             ccpi.custom_segment3,             Case when ccpi.custom_segment46 = 60 then 'Outperforming'             when ccpi.custom_segment46 = 50 then 'Exceeds Expectations'             when ccpi.custom_segment46 = 40 then 'Solid Performer'             when ccpi.custom_segment46 = 30 then 'Developing Performer'             when ccpi.custom_segment46 = 20 then 'Needs Improvement'             when ccpi.custom_segment46 = 10 then 'Underperforming'             else 'not rated' end ) perf                     where             perf.person_id=paa.person_id                             AND ROWNUM = 1             ) */        ,        CASE          --Hager: exclude ratings for any of the Executives (who haveSal Grade of EXEC).           WHEN Upper(pgf.name) LIKE 'EXEC%' THEN ''          ELSE DESCRIP.rating        END                                                     LYperfrating,        /*dms: replace to_char with field for birthdate    , to_char(per1.date_of_birth,'MM/DD/YYYY')    BirthDate*/        /*-- , per1.date_of_birth                                 BirthDate                       --dms date field as date for better formatting         ,round(months_between(:p_effective_date, per1.date_of_birth)/12,2)  Age --*/        hla.location_name                                       AS        Work_Facility_Location,        hla.address_line_1                                      AS Work_Address_1        ,        hla.address_line_2                                      AS        Work_Address_2,        hla.town_or_city                                        AS Work_City        /* ,(SELECT hzg.geography_code              FROM hz_geographies hzg             WHERE hzg.country_code = 'US'               AND hzg.geography_use = 'MASTER_REF'               AND hzg.geography_type = 'STATE'               AND hzg.geography_element1 = 'United States'               AND (UPPER(hzg.geography_name) = UPPER(hla.region_2)  OR UPPER(hzg.geography_code) = UPPER(hla.region_2))              )   */        ,        (SELECT hzg.geography_code         FROM   hz_geographies hzg         WHERE  hzg.country_code = 'US'                AND hzg.geography_use = 'MASTER_REF'                AND hzg.geography_type = 'STATE'                AND hzg.geography_element1 = 'United States'                AND hzg.geography_name = hla.region_2)          region_2,        hla.postal_code                                         AS Work_Zip,        hla.region_1                                            County,        hla.internal_location_code        Facility_number_code,        pjl.information2                                        Job_EEO,        pj.attribute1                                           Job_EEO_Grp,        Substr (dp.name, 5, 5)                                  cc,        pj.attribute4                                           BonusElig,        paa.ass_attribute3                                      TeamCode /* dms old columns      , pe.ethnicity EthCode      , pj.ATTRIBUTE3 WC_code      ,pj.ATTRIBUTE_NUMBER1 compFlex1      , pj.ATTRIBUTE_NUMBER4 compFlex2      , paa.employment_category Emp_Category_Code    --Hager: New Field 2017-05-31 to clarify which rating is being displayed  TO_CHAR(DESCRIP.FROM_DATE , 'MM/DD/YYYY')  RATING_EFF_DT ,         , hla.attribute4                                                                                                            BranchNum         , per2.attribute1                                                                                                           supNetworkId         , NVL ((SELECT   CASE                          WHEN (TO_NUMBER ( SUBSTR ( pgf.name, 1,2))) >= 60 THEN 'A'                          WHEN (TO_NUMBER ( SUBSTR ( pgf.name, 1,2))) >= 44                                  AND (TO_NUMBER ( SUBSTR ( pgf.name, 1,2))) <= 59                               THEN 'B'                          WHEN (TO_NUMBER ( SUBSTR ( pgf.name, 1,2))) >= 41                                  AND (TO_NUMBER ( SUBSTR ( pgf.name, 1,2))) <= 43                               THEN 'C'                          ELSE                              'D'                    END                             EBI                 FROM dual                 WHERE regexp_like ( substr (pgf.name, 1, 1), '[0-9]')                 AND   regexp_like ( substr (pgf.name, 2, 1), '[0-9]')                 ), 'D')                                                                                                             emailBoxIndicator   DECODE ( hla.REGION_2                          ,  'Minnesota',                   'MN'                          ,  'Ohio',                        'OH'                          ,  'Indiana',                     'IN'                          ,  'Texas',                       'TX'                          ,  'Missouri',                    'MO'                          ,  'Michigan',                    'MI'                          ,  'Wisconsin',                   'WI'                          ,  'Illinois',                    'IL'              ,   'Alabama',     'AL'                 ,   'Alaska',     'AK'                 ,   'Arizona',     'AZ'                 ,   'Arkansas',     'AR'                 ,   'California',     'CA'                 ,   'Colorado',     'CO'                 ,   'Connecticut',     'CT'                 ,   'Delaware',     'DE'                 ,   'Florida',     'FL'                 ,   'Georgia',     'GA'                 ,   'Hawaii',     'HI'                 ,   'Idaho',     'ID'                 ,   'Iowa',     'IA'                 ,   'Kansas',     'KS'                 ,   'Kentucky',     'KY'                 ,   'Louisiana',     'LA'                 ,   'Maine',     'ME'                 ,   'Maryland',     'MD'                 ,   'Massachusetts',     'MA'                   ,   'Mississippi',     'MS'                 ,   'Montana',     'MT'                 ,   'Nebraska',     'NE'                 ,   'Nevada',     'NV'                 ,   'New Hampshire',     'NH'                 ,   'New Jersey',     'NJ'                 ,   'New Mexico',     'NM'                 ,   'New York',     'NY'                 ,   'North Carolina',     'NC'                 ,   'North Dakota',     'ND'                 ,   'Oklahoma',     'OK'                 ,   'Oregon',     'OR'                 ,   'Pennsylvania',     'PA'                 ,   'Rhode Island',     'RI'                 ,   'South Carolina',     'SC'                 ,   'South Dakota',     'SD'                 ,   'Tennessee',     'TN'                 ,   'Utah',     'UT'                 ,   'Vermont',     'VT'                 ,   'Virginia',     'VA'                 ,   'Washington',     'WA'                 ,   'West Virginia',     'WV'                 ,   'Wyoming',     'WY'                   , hla.REGION_2                       )             State   end old columns*/ FROM   (SELECT hp.person_id,                rating_description,                hpi.date_from,                hci.name         FROM   hrt_rating_levels_vl hrl,                hrt_profiles_vl hp,                hrt_profile_items hpi,                hrt_content_items_vl hci,                hrt_content_types_vl hct         WHERE  hct.content_type_name = 'ABC Performance Rating'                AND hct.content_type_id = hci.content_type_id                AND hci.content_item_id = hpi.content_item_id                AND hct.content_type_id = hpi.content_type_id                AND hpi.profile_id = hp.profile_id                AND hpi.rating_level_id1 = hrl.rating_level_id                AND Substr(hci.name, -4) = (SELECT Max(Substr(hcix.name, -4))                                            FROM   hrt_content_items_vl hcix,                                                   hrt_profile_items hpix,                                                   hrt_profiles_vl hpx                                            WHERE  hpx.person_id = hp.person_id                                                   AND hpx.profile_id =                                                       hpix.profile_id                                                   AND hpix.content_type_id =                                                       hpi.content_type_id                                                   AND hpix.content_item_id =                                                       hcix.content_item_id))        prev,        per_all_people_f papf,        per_persons per1,-- Person         per_person_type_usages_f pptu,        per_person_types ppt,        per_all_assignments_m paa,        --per_assignment_secured_list_v paa,         fun_all_business_units_v fabu,        per_departments dp,        per_person_names_f ppn,        per_phones pp1,-- Work phones         hr_locations_all hla,        per_periods_of_service ppos,        per_email_addresses pea1,-- Person email         per_assignment_supervisors_f pas,        per_persons per2,-- Supervisor Person         per_email_addresses pea2,-- Suppervisor email         per_person_names_f ppn2,-- Suppervisor name         per_all_people_f papf2,-- Suppervisor Per Record         per_jobs_f pj,        per_grades_f_vl pgf,        per_job_leg_f pjl,        per_assignment_status_types_vl past,        hr_all_organization_units_f hao,        -----    hr_all_organization_units_f_vl haou , /*changed to just hr_all_organization_units_f_vl*/        per_assign_work_measures_f pawm,        cmp_salary sal,        cmp_salary_bases sb,        per_people_legislative_f leg,        per_rate_values_f prv,        per_people_extra_info_f ppei,        per_ethnicities pe,        fnd_lookup_values fnd,        fnd_lookup_values fndCat,        per_jobs_f_tl pjp,        hr_organization_units_f_tl haotl,        (SELECT PAPF2.person_number      EE_NUMJBER,                PAPF2.person_id          PERS_ID,                HRP2.profile_id          IDPROFILE_ID,                PROFIT2.date_from        FROM_DATE,                PROFIT2.date_to          TO_DATE,                RLEV2.rating_description RATING         FROM   per_all_people_f PAPF2                inner join hrt_profiles_b HRP2                        ON PAPF2.person_id = HRP2.person_id                inner join hrt_profile_items PROFIT2                        ON HRP2.profile_id = PROFIT2.profile_id                           AND PROFIT2.content_type_id IN                               ( 125, 300000005200855 )                inner join hrt_rating_levels_tl RLEV2                        ON PROFIT2.rating_level_id1 = RLEV2.rating_level_id         WHERE  1 = 1                /* :p_effective_date between papf2.effective_start_date and papf2.effective_end_date */                AND PROFIT2.date_from = (SELECT Max(X.date_from)                                         FROM   hrt_profile_items X                                         WHERE  X.profile_id = HRP2.profile_id                                                AND X.content_type_id =                                                    PROFIT2.content_type_id        /*AND X.date_from <=             :p_effective_date*/)        /*AND To_char(PROFIT2.date_from, 'YYYY') =             To_char(:p_effective_date, 'YYYY')*/) DESCRIP WHERE  1 = 1        /*AND   :p_effective_date             BETWEEN papf.effective_start_date AND papf.effective_end_date*/        AND per1.person_id = papf.person_id        AND pptu.person_id = papf.person_id        /*AND   :p_effective_date             BETWEEN pptu.effective_start_date AND pptu.effective_end_date*/        AND ppt.person_type_id = pptu.person_type_id        AND ppt.system_person_type = 'EMP'        AND paa.person_id = papf.person_id        AND paa.effective_latest_change = 'Y'        AND paa.primary_flag = 'Y'        AND paa.assignment_type = 'E'        AND paa.system_person_type = 'EMP'        /*AND   :p_effective_date             BETWEEN paa.effective_start_date AND paa.effective_end_date*/        AND fabu.bu_id (+) = paa.business_unit_id        AND dp.organization_id (+) = paa.organization_id        /*and   :p_effective_date             BETWEEN dp.effective_start_date (+) AND dp.effective_end_date (+)*/        AND ppn.person_id = papf.person_id        AND ppn.name_type = 'GLOBAL'        /*AND   :p_effective_date             BETWEEN ppn.effective_start_date AND ppn.effective_end_date*/        AND pp1.person_id (+) = papf.person_id        AND pp1.phone_type (+) = 'W1'        /* AND   pp1.phone_id (+)              =   papf.primary_phone_id */        /*AND   :p_effective_date             BETWEEN pp1.date_from (+) AND nvl ( pp1.date_to (+) , :p_effective_date)*/        AND hla.location_id (+) = paa.location_id        /*AND   :p_effective_date             BETWEEN hla.effective_start_date (+) AND hla.effective_end_date (+)*/        AND ppos.period_of_service_id = paa.period_of_service_id        /*AND   :p_effective_date             BETWEEN ppos.date_start AND nvl ( ppos.actual_termination_date, :p_effective_date )*/        AND pea1.person_id (+) = papf.person_id        AND pea1.email_type (+) = 'W1'        AND pea1.email_address_id (+) = papf.primary_email_id        /*AND   :p_effective_date             BETWEEN nvl (pea1.date_from (+),:p_effective_date)  AND nvl ( pea1.date_to (+),                   :p_effective_date)  */        AND pas.person_id (+) = paa.person_id        AND pas.assignment_id (+) = paa.assignment_id        AND pas.primary_flag (+) = 'Y'        AND Lower (pas.manager_type (+)) LIKE '%line%'        /* AND   :p_effective_date             BETWEEN pas.effective_start_date (+)  AND pas.effective_end_date (+) */        AND per2.person_id (+) = pas.manager_id        AND papf2.person_id (+) = pas.manager_id        /*AND   :p_effective_date             BETWEEN papf2.effective_start_date (+) AND papf2.effective_end_date (+)*/        AND pea2.person_id (+) = papf2.person_id        AND pea2.email_type (+) = 'W1'        AND pea2.email_address_id (+) = papf2.primary_email_id        /*AND   :p_effective_date             BETWEEN nvl ( pea2.date_from (+), :p_effective_date) AND nvl ( pea2.date_to (+),                   :p_effective_date)*/        AND ppn2.person_id (+) = pas.manager_id        AND ppn2.name_type (+) = 'GLOBAL'        /*AND   :p_effective_date             BETWEEN ppn2.effective_start_date (+) AND ppn2.effective_end_date (+)*/        AND pj.job_id (+) = paa.job_id        /*AND   :p_effective_date             BETWEEN pj.effective_start_date (+) AND pj.effective_end_date (+)*/        AND pgf.grade_id (+) = paa.grade_id        /*and   :p_effective_date             BETWEEN pgf.effective_start_date (+) AND pgf.effective_end_date (+)*/        AND pjl.information_category(+) LIKE 'HRX_US_JOBS'        AND pjl.job_id (+) = pj.job_id        /*AND   :p_effective_date             BETWEEN pjl.effective_start_date (+) AND pjl.effective_end_date (+)*/        AND past.assignment_status_type_id = paa.assignment_status_type_id        AND paa.organization_id = hao.organization_id (+)        /*AND    paa.effective_start_date --  :p_effective_date        BETWEEN hao.effective_start_date (+) AND hao.effective_end_date (+)*/        AND paa.assignment_id = pawm.assignment_id (+)        /*AND   :p_effective_date BETWEEN NVL(pawm.effective_start_date (+),:p_effective_date )                                  AND NVL (pawm.effective_end_date (+),:p_effective_date )  */        AND pawm.unit (+) = 'FTE'        AND paa.assignment_id = sal.assignment_id (+)        /*AND   :p_effective_date BETWEEN NVL(sal.date_from (+),:p_effective_date ) and NVL(sal.date_to (+),:p_effective_date ) */        AND sal.salary_approved (+) = 'Y'        AND sal.salary_basis_id = sb.salary_basis_id (+)        AND paa.person_id = prev.person_id (+)        AND papf.person_id = leg.person_id (+)        /*AND   :p_effective_date BETWEEN NVL(leg.effective_start_date (+),:p_effective_date)                                  AND NVL(leg.effective_end_date (+), :p_effective_date) */        AND leg.legislation_code (+) = 'US'        AND pgf.grade_id = prv.rate_object_id (+)        AND prv.rate_object_type (+) = 'GRADE'        /*AND   :p_effective_date    BETWEEN NVL(prv.effective_start_date (+),:p_effective_date) AND NVL(prv.effective_end_date (+),:p_effective_date)  */        AND papf.person_id = ppei.person_id (+)        AND ppei.information_type (+) = 'ABC_OFFICER_INFO'        AND ppei.pei_information3 (+) = 'Y'        /*AND :p_effective_date BETWEEN NVL(ppei.pei_information_date1 (+),:p_effective_date) AND NVL (ppei.pei_information_date2 (+),:p_effective_date)*/        /*AND (ppei.effective_start_date = (Select MAX(ppei3.effective_start_date)                                                      From per_people_extra_info_f  ppei3                                                       Where ppei.person_id = ppei3.person_id                                                          AND ppei3.information_type        = 'ABC_OFFICER_INFO'                                                         AND ppei3.pei_information3         = 'Y'                                                          AND (    (    :p_effective_date BETWEEN  ppei3.pei_information_date1 AND ppei3.pei_information_date2)                                                          OR ppei3.pei_information_date2 IS NULL)) OR ppei.person_id IS NULL    ) */        AND papf.person_id = pe.person_id (+)        AND fnd.lookup_type (+) = 'PER_ETHNICITY'        AND fnd.source_lang (+) = 'US'        AND fnd.lookup_code (+) = pe.ethnicity        AND paa.employment_category = fndCat.lookup_code (+)        --CRITERIA FOR DESCRIP         AND DESCRIP.pers_id(+) = PAPF.person_id        AND pjp.job_id (+) = paa.job_id        /*AND   :p_effective_date             BETWEEN pjp.effective_start_date (+) AND pjp.effective_end_date (+)*/        --and papf.person_number in ('425527','423820','122437')         --DMS start: change order by per request 10/2/17 person_number ASC        AND hao.organization_id = haotl.organization_id        AND haotl.LANGUAGE = Userenv('LANG')        AND haotl.effective_start_date = hao.effective_start_date        AND haotl.effective_end_date = hao.effective_end_date        /*logic to find most recent start date*/        AND paa.effective_start_date = (SELECT Max (paa_z.effective_start_date)                                        FROM   per_all_assignments_m paa_z                                        WHERE            paa.assignment_id = paa_z.assignment_id            AND paa_z.effective_start_date <= SYSDATE                                       )   
